component: aws-dynamodb
name: database

inputs:
  name: ${name}-${stage}
  region: ap-southeast-1
  # Don't delete the Database Table if "serverless remove" is run
  deletionPolicy: retain
  # Simple, single-table design
  attributeDefinitions:
    - AttributeName: pk
      AttributeType: S
    - AttributeName: sk
      AttributeType: S
    - AttributeName: classId
      AttributeType: S
    - AttributeName: coinTotal
  keySchema:
    - AttributeName: pk
      KeyType: HASH
    - AttributeName: sk
      KeyType: RANGE
  globalSecondaryIndexes:
    - IndexName: ClassIndex
      KeySchema:
        - AttributeName: classId
          KeyType: HASH
        - AttributeName: sk
          KeyType: RANGE
      Projection:
        NonKeyAttributes:
          - pk
          - response
          - question
          - meta
          - coinTotal
          - name
          - gamification
        ProjectionType: INCLUDE
    - IndexName: LeaderboardIndex
      KeySchema:
        - AttributeName: pk
          KeyType: HASH
        - AttributeName: coinTotal
          KeyType: RANGE
      Projection:
        NonKeyAttributes:
          - sk
          - classId
          - name
          - gamification
        ProjectionType: INCLUDE
    - IndexName: ReverseIndex
      KeySchema:
        - AttributeName: sk
          KeyType: HASH
        - AttributeName: pk
          KeyType: RANGE
      Projection:
        NonKeyAttributes:
          - classId
          - coinTotal
          - name
          - gamification
          - powerupsBought